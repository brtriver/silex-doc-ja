
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>使用方法 (Usage) | Japan Symfony Group</title>
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/js/jquery.corner.js"></script>
      <script type="text/javascript" src="_static/configurationblock.js"></script>
      <script type="text/javascript">
      $(function(){
          $('.section h1').corner();
          $('.highlight-python pre').corner();
          $('.highlight-yml pre').corner();
          $('.highlight-json pre').corner();
          $('.highlight').corner();
      });
      </script>
    <link rel="top" title="Silex 0.0.0 documentation" href="index.html" />
    <link rel="next" title="ミドルウェア (Middlewares)" href="middlewares.html" />
    <link rel="prev" title="イントロダクション (Introduction)" href="intro.html" /> 
  </head>
  <body>

<div id="all">
  <div id="content">
    <div id="content_wrapper">
      <p class="title">Silex ユーザーガイド</title>
      <!-- end #header -->
      <div id="navbar">
        <ul>
          <li><a href="/">Silex ユーザーガイド</a></li>
          <li><a href="index.html">日本語ドキュメント TOP (索引)</a></li>
          <li><a href="providers/index.html">エクステンション一覧</a></li>
          <li><a href="http://silex.sensiolabs.org/">Silex 公式サイト(英語)</a></li>
          <li><a href="http://www.symfony.gr.jp/">日本Symfonyユーザー会</a></li>
        </ul>
      </div>
      <!-- end #navbar -->
      <div id="main">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usage">
<h1>使用方法 (Usage)<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>この章では Silex の使い方について説明します。</p>
<div class="section" id="installation">
<h2>インストール (Installation)<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>早くSilexを始めたい場合はSilexをアーカイブとして <a class="reference external" href="http://silex.sensiolabs.org/download">download</a> して展開してください。そうすると以下の様なディレクトリ構造が得られるはずです。</p>
<div class="highlight-text"><div class="highlight"><pre>├── composer.json
├── composer.lock
├── vendor
│   └── ...
└── web
    └── index.php
</pre></div>
</div>
<p>Silexをもっと柔軟に使いたい場合は、 <a class="reference external" href="http://getcomposer.org/">Composer</a> を用います。
まず以下の様な <code class="docutils literal"><span class="pre">composer.json</span></code> を作ってください。</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;silex/silex&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.1&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>その後に、 <a class="reference external" href="http://getcomposer.org/">Composer</a> を実行すればSilexと、それに関する全ての依存パッケージがインストールされます。</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>curl -s http://getcomposer.org/installer <span class="p">|</span> php
<span class="nv">$ </span>php composer.phar install
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">デフォルトでは、SilexはSymfonyの安定版のコンポーネントに依存しています。
それらのmasterバージョンを使用したい場合は、 <code class="docutils literal"><span class="pre">composer.json</span></code> に、
<code class="docutils literal"><span class="pre">&quot;minimum-stability&quot;:</span> <span class="pre">&quot;dev&quot;</span></code> と付け加えてください。</p>
</div>
</div>
<div class="section" id="upgrading">
<h2>アップグレード (Upgrading)<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h2>
<p>Silexを最新版にアップグレードするには、以下の <code class="docutils literal"><span class="pre">update</span></code> コマンドを実行してください。</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php composer.phar update
</pre></div>
</div>
</div>
<div class="section" id="bootstrap">
<h2>ブートストラップ (Bootstrap)<a class="headerlink" href="#bootstrap" title="Permalink to this headline">¶</a></h2>
<p>Silexを使うのに必要なのは <code class="docutils literal"><span class="pre">vendor/autoload.php</span></code> をrequireし、 <code class="docutils literal"><span class="pre">Silex\Application</span></code> のインスタンスを生成することだけです。
コントローラ定義の後に、 <code class="docutils literal"><span class="pre">run</span></code> メソッドをアプリケーション上で呼んでください。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// web/index.php</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Silex\Application</span><span class="p">();</span>

<span class="c1">// 定義をここに書きます。</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
<p>その後にWebサーバーの設定が必要となります。（詳しくは、 <a class="reference internal" href="web_servers.html"><em>Webサーバーの章</em></a> を見てください。).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>ウェブサイトを開発中のときは、デバッグしやすくするためにデバッグモードを有効にすることもできます。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>もしアプリケーションを$ipというアドレスを持つプロキシサーバーを通して動作させたい場合は Silex が <cite>X-Forwarded-For</cite> ヘッダーを信頼するようにしたいでしょう。
その場合は次のようにアプリケーションを実行させる必要があります。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">setTrustedProxies</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$ip</span><span class="p">));</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="routing">
<h2>ルーティング (Routing)<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h2>
<p>Silex ではルーティングと、そのルーティングに一致したときに実行されるコントローラーを定義します。</p>
<p>ルーティングのパターンは次のような構成になっています。</p>
<ul class="simple">
<li><em>パターン (Pattern)</em>: ルーティングパターンであり、リソースへのパスを定義します。
パターンは可変部分を含むことができ、正規表現を使った必須項目を設定することもできます。</li>
<li><em>メソッド (Method)</em>: HTTPメソッド( <code class="docutils literal"><span class="pre">GET</span></code>, <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code> <code class="docutils literal"><span class="pre">DELETE</span></code> )のうち、どれかを指定します。  これはリソースとの相互作用を表しています。
一般的には、 <code class="docutils literal"><span class="pre">GET</span></code> と <code class="docutils literal"><span class="pre">POST</span></code> だけが利用されますが、他のメソッドも使うことが可能です。</li>
</ul>
<p>コントローラーはクロージャーを次のように使うことで定義できます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>
</pre></div>
</div>
<p>クロージャーは定義の外部から状態を取り込むことができる無名関数のことです。
これはグローバル変数とは異なります、なぜなら外部の状態はグローバルである必要がないからです。
たとえば、メソッドの中にクロージャーを定義することができ、メソッドのローカル変数を取り込むことができます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">スコープを取り込まないクロージャーはラムダのようだと言われます。
なぜなら PHP の無名関数はすべて <code class="docutils literal"><span class="pre">Closure</span></code> クラスのインスタンスであり、区別することができないからです。</p>
</div>
<p>クロージャーの戻り値はページのコンテンツになります。</p>
<p>クラスメソッドを利用してコントローラを定義する方法もあります。
<code class="docutils literal"><span class="pre">ClassName::methodName</span></code> でのスタティックな呼び出し構文も利用可能です。</p>
<div class="section" id="get-example-get-route">
<h3>GET ルーティングの例 (Example GET route)<a class="headerlink" href="#get-example-get-route" title="Permalink to this headline">¶</a></h3>
<p>ここに <code class="docutils literal"><span class="pre">GET</span></code> ルーティングを定義した例があります。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$blogPosts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;date&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;2011-03-29&#39;</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;igorw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Using Silex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blogPosts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/blog</span></code> へアクセスすると 投稿されたブログのタイトルの一覧が返されます。
ここで使われている <code class="docutils literal"><span class="pre">use</span></code> はこの文脈では別のものであることを意味します。
外部スコープから $blogPosts 変数を取り込むということをクロージャーに知らせています。
<code class="docutils literal"><span class="pre">use</span></code> を使うことでクロージャー内で渡した変数を使うことができるようになります。</p>
</div>
<div class="section" id="dynamic-routing">
<h3>動的ルーティング (Dynamic routing)<a class="headerlink" href="#dynamic-routing" title="Permalink to this headline">¶</a></h3>
<p>さて、ブログの個々の記事を閲覧するためのもう1つ別のコントローラーを用意してみましょう。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>

    <span class="k">return</span>  <span class="s2">&quot;&lt;h1&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span><span class="o">.</span>
            <span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>ルーティングはクロージャーに渡される <code class="docutils literal"><span class="pre">{id}</span></code> という変数を定義しています。</p>
<p>なお、タイプヒンティングのおかげで、 <code class="docutils literal"><span class="pre">Application</span></code> は、 Silex によって自動的にクロージャに注入されています。</p>
<p>POST された値がなかったとき、より早い段階でリクエストを停止するために <code class="docutils literal"><span class="pre">abort()</span></code> を使います。実際には例外を投げていますが、どのように扱うかは後ほど説明します。</p>
</div>
<div class="section" id="post-example-post-route">
<h3>POST ルーティングの例 (Example POST route)<a class="headerlink" href="#post-example-post-route" title="Permalink to this headline">¶</a></h3>
<p>POSTルーティングはリソースの生成を意味します。
この例となるのがフィードバック用のフォームです。
ここでは <code class="docutils literal"><span class="pre">mail</span></code> 関数を使ってメールを送信してみます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/feedback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
    <span class="nb">mail</span><span class="p">(</span><span class="s1">&#39;feedback@yoursite.com&#39;</span><span class="p">,</span> <span class="s1">&#39;[YourSite] Feedback&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Thank you for your feedback!&#39;</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>とても素直な実装になっています。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">mail()</span></code> 関数を使用する代わりに、 <a class="reference internal" href="providers/swiftmailer.html"><em>SwiftmailerServiceProvider</em></a> も使用できます。</p>
</div>
<p>タイプヒンティングのおかげで、 <code class="docutils literal"><span class="pre">request</span></code> は、 Silex によって自動的にクロージャに注入されています。
リクエストは <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a>
のインスタンスです。このことによって、HTTPステータスコードを設定することが可能になります。今回の例では``201　Created`` に設定されます。</p>
<p>リクエストの <code class="docutils literal"><span class="pre">get</span></code> メソッドを使うことで変数を取得することができます。</p>
<p>文字列を返す代わりに <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html">Response</a> のインスタンスを返しています。
また、 HTTP のステータスコードを設定することもでき、今回の場合であれば <code class="docutils literal"><span class="pre">201</span> <span class="pre">Created</span></code> が設定されています。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Silexは、常に <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html">Response</a> を内部で使用し、 文字列を <code class="docutils literal"><span class="pre">200</span> <span class="pre">OK</span></code> の HTTP のステータスコードと一緒にレスポンスオブジェクトに変換します。</p>
</div>
</div>
<div class="section" id="other-methods">
<h3>他のメソッド (Other methods)<a class="headerlink" href="#other-methods" title="Permalink to this headline">¶</a></h3>
<p>アプリケーションの中で、 <code class="docutils literal"><span class="pre">get</span></code>, <code class="docutils literal"><span class="pre">post</span></code>, <code class="docutils literal"><span class="pre">put</span></code>, <code class="docutils literal"><span class="pre">delete</span></code> といったメソッドを呼び出せば、ほとんどの HTTP メソッドのためのコントローラーを作ることが可能です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>ほとんどのウェブブラウザのフォームは、その他のHTTPメソッドを直接サポートしていません。GETやPOST以外のメソッドを使いたい場合は、 <code class="docutils literal"><span class="pre">_method</span></code> という名前を持つ特別なフォームフィールドを使うことができます。このフォームフィールドを使うときには、フォームの <code class="docutils literal"><span class="pre">method</span></code> 属性をPOSTに設定する必要があります。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;/my/target/route/&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
    <span class="o">...</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;_method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Symfonyコンポーネント2.2以上を使用している場合は、明示的にメソッドのオーバーライドを可能にする必要があります。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">enableHttpMethodParameterOverride</span><span class="p">();</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
<p>また、 <code class="docutils literal"><span class="pre">match</span></code> メソッドを利用することもでき、この場合はすべてのメソッドに一致します。
この性質は、 <code class="docutils literal"><span class="pre">method</span></code> メソッドを用いることで制限することができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PUT|POST&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ルーティングがどのような順番で定義されたかはとても重要です。
最初に一致したルーティングが利用されるからです。そのため、より汎用的なルーティングはより下の方に定義するようにしてください。</p>
</div>
</div>
<div class="section" id="route-variables">
<h3>ルーティング変数 (Route variables)<a class="headerlink" href="#route-variables" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>前に説明したように、次のようにルーティングにおいて変数を定義することができます.</dt>
<dd><div class="first last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
</dd>
</dl>
<p>ルーティングの変数部分の名前がクロージャーの引数に一致するようにすれば、2つ以上の変数部分を定義することが可能です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>説明していませんでしたが、次のように引数の順番を入れ替えることだってできます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$commentId</span><span class="p">,</span> <span class="nv">$postId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>現在のリクエストとアプリケーションオブジェクトを次のように利用することもできます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/show/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>アプリケーションとリクエストオブジェクトについてですが、 Silex は変数名ではなく、タイプヒンティングに基づいて注入します。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$bar</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="route-variables-converters">
<h3>ルーティングで取得される変数の変換　(Route variables converters)<a class="headerlink" href="#route-variables-converters" title="Permalink to this headline">¶</a></h3>
<p>コントローラーにルーティングで取得した変数を注入する前に、変換処理をはさむことができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">;</span> <span class="p">});</span>
</pre></div>
</div>
<p>たとえば、ルーティングで取得した変数をオブジェクトに変換し、異なるコントローラー間で再利用性を高めたい場合などに便利です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userProvider</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}/edit&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>
</pre></div>
</div>
<p>変換処理のコールバックは <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a> を第2引数として受け取ることができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">));</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}/{slug}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
<p>変換処理はサービスとしても定義できます。例として、以下の様なDoctrine ObjectManagerによるユーザーコンバーターが挙げられます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserConverter</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$om</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$om</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span> <span class="o">=</span> <span class="nv">$om</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">convert</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;User %d does not exist&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>このサービスはアプリケーションで登録されることはなく、コンバートメソッドはコンバーターとして使われます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;converter.user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserConverter</span><span class="p">();</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;converter.user:convert&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="requirements">
<h3>必須項目 (Requirements)<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>特定のパターンのみ一致させたい場合があるでしょう。そのときはルーティングメソッドによって返される <code class="docutils literal"><span class="pre">Controller</span></code> オブジェクトの <code class="docutils literal"><span class="pre">assert</span></code> メソッドを呼ぶことで正規表現による必須項目を定義することができます。</p>
<p>次の例では <code class="docutils literal"><span class="pre">id</span></code> という引数が数値になるように <code class="docutils literal"><span class="pre">\d+</span></code> でチェックしています。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>チェーン(chain)で呼び出すこともできます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;postId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;commentId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="default-values">
<h3>デフォルト値 (Default values)<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">Controller</span></code> オブジェクトの <code class="docutils literal"><span class="pre">value</span></code> メソッドを呼ぶことで、どんなルーティングの値でもデフォルト値を定義することができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/{pageName}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$pageName</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;pageName&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>この例では、 <code class="docutils literal"><span class="pre">/</span></code> をルーティングに一致させています。そしてその際は、 <code class="docutils literal"><span class="pre">pageName</span></code> 変数は <code class="docutils literal"><span class="pre">index</span></code> になります。</p>
</div>
<div class="section" id="named-routes">
<h3>名前付きルーティング (Named routes)<a class="headerlink" href="#named-routes" title="Permalink to this headline">¶</a></h3>
<p>プロバイダーの中には名前付きルーティングを使うことができるものがあります (<code class="docutils literal"><span class="pre">UrlGeneratorProvider</span></code> など)。
デフォルトでは、 Silex はあなたの代わりにルーティング名を生成してくれます。しかし、これらは利用されません。
ルーティングメソッドによって返される <code class="docutils literal"><span class="pre">Controller</span></code> オブジェクトの <code class="docutils literal"><span class="pre">bind</span></code> メソッドを呼び出すことでルーティングに名前を付けることができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;blog_post&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">使おうとしているプロバイダーが <code class="docutils literal"><span class="pre">RouteCollection</span></code> を利用しているときのみ名前ルーティングは意味があります。</p>
</div>
</div>
<div class="section" id="controllers-in-classes">
<h3>クラス内コントローラ (Controllers in classes)<a class="headerlink" href="#controllers-in-classes" title="Permalink to this headline">¶</a></h3>
<p>無名関数を使いたくない場合、コントローラをメソッドとして定義することが出来ます。
これは <code class="docutils literal"><span class="pre">ControllerClass::methodName</span></code> という文法によって実現されます。このときコントローラオブジェクトの生成を遅延させることが可能です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme\\Foo::bar&#39;</span><span class="p">);</span>

<span class="k">use</span> <span class="nx">Silex\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nx">Acme</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Foo</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Application</span> <span class="nv">$app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="o">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この例は レスポンスを得るために、 <code class="docutils literal"><span class="pre">Igorw\Foo</span></code> というクラスを要求に応じて読み込み、インスタンスを生成した後に、 <code class="docutils literal"><span class="pre">bar</span></code> メソッドを呼び出します。このとき、 <code class="docutils literal"><span class="pre">$request</span></code> と <code class="docutils literal"><span class="pre">$app</span></code> をクロージャに注入するために <a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a> と <code class="docutils literal"><span class="pre">Silex\Application</span></code> というタイプヒンティングが使用可能です。</p>
<p>こうすることで、Silexとあなたのコントローラの分離度が強まるため、 <a class="reference internal" href="providers/service_controller.html"><em>コントローラをサービスとして定義することが出来ます。</em></a>.</p>
</div>
</div>
<div class="section" id="global-configuration">
<h2>全体の設定 (Global Configuration)<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h2>
<p>あるコントローラの設定を全てのコントローラに対して適用したい場合（例えば、コンバーター、ミドルウェア、必須項目、デフォルト値など）、 全てのコントローラを保持する <code class="docutils literal"><span class="pre">$app['controllers']</span></code> に対して設定を行うことができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">]</span>
    <span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">requireHttps</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
<span class="p">;</span>
</pre></div>
</div>
<p>これらの設定は全ての登録済みコントローラに適用され、また新しいコントローラのデフォルト設定にもなります。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">全体の設定は、オリジナルの全体への設定を持つコントローラプロバイダーには適用されません。
詳しくは、 <a class="reference internal" href="organizing_controllers.html"><em>コントローラの組織化</em></a> を読んでください。</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">コンバーターは <strong>全ての</strong> 登録済みコントローラに対して実行されます。</p>
</div>
</div>
<div class="section" id="error-handlers">
<h2>エラーハンドリング (Error handlers)<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h2>
<p>コードのどこかで例外が発生した際に、ユーザーにエラーページのようなものを表示したいことがあるでしょう。
これらエラーハンドラーがやることなのです。
ログ処理のような処理を追加してエラーハンドリングを使うことができます。</p>
<p>エラーハンドラーを登録するために、 <code class="docutils literal"><span class="pre">Exception</span></code> を引数に持ち、レスポンスを返してくれる <code class="docutils literal"><span class="pre">error</span></code> メソッドにクロージャーを渡します。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">$code</span></code> 引数を使うことで詳細なエラーを確認することができます。そしてエラーの種類で処理を変えることができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">404</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;The requested page could not be found.&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Silexはレスポンスのステータスコードが例外に沿うような適切な物にセットされることを保証するので、例外が生じた場合、レスポンスでのステータスコードの設定が働きません。ステータスコードをオーバーライドしたい場合は（適切な理由が無い限りそうすべきではありませんが）、 <code class="docutils literal"><span class="pre">X-Status-Code</span></code> ヘッダをセットしてください。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="mi">404</span> <span class="cm">/* 無視されます */</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;X-Status-Code&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>クロージャの引数に対し詳細なタイプヒンティングをセットすることで、エラーハンドラの適用範囲を特定の例外クラスに対してのみに制限することができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\LogicException</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// このハンドラーは\LogicExceptionと、そのサブクラスのみを扱います。</span>
<span class="p">});</span>
</pre></div>
</div>
<p>ログ処理を行いたいなら、このためにエラーハンドラーを分けて使うことができます。
レスポンスのエラーハンドラーの前にロギング処理を登録しなければならないということに注意してください。
なぜならレスポンスが返されてしまうと、後続のハンドラーは無視されてしまうからです。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Silex にはエラーのログ処理を行うための <a class="reference external" href="https://github.com/Seldaek/monolog">Monolog</a>
プロバイダーも付いてきます。
詳しくは <em>Providers</em> の章を参照してください。</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Silex には、デフォルトのエラーハンドラーが付いており、 <strong>debug</strong> を true にすることで、スタックトレースを含む詳細なエラーメッセージを表示します。 false の際には、シンプルなエラーメッセージを表示します。
<code class="docutils literal"><span class="pre">error()</span></code> メソッドを通して登録したエラーハンドラーは常に優先されますが、デバッグモードが有効の際に表示する便利なエラーも次のようにすれば大丈夫です。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// エラーのハンドリングと、レスポンスを返す処理</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>より早い段階でリクエストを破棄するために <code class="docutils literal"><span class="pre">abort</span></code> を使うときにもエラーハンドラーは呼ばれます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="redirects">
<h2>リダイレクト (Redirects)<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h2>
<p>リダイレクトレスポンスを返すことでどんなページにもリダイレクトすることができます。このリダイレクト処理のレスポンスは <code class="docutils literal"><span class="pre">redirect</span></code> メソッドで作成することができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>この例では <code class="docutils literal"><span class="pre">/</span></code> から <code class="docutils literal"><span class="pre">/hello</span></code> にリダイレクトします。</p>
</div>
<div class="section" id="forwards">
<h2>フォワード (Forwards)<a class="headerlink" href="#forwards" title="Permalink to this headline">¶</a></h2>
<p>(リダイレクト時に発生するような)ブラウザの往復無しで、他のコントローラにレンダリングを移譲したい場合、内部的なサブリクエストを用いることが出来ます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\HttpKernelInterface</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// /helloへのリダイレクト</span>
    <span class="nv">$subRequest</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$subRequest</span><span class="p">,</span> <span class="nx">HttpKernelInterface</span><span class="o">::</span><span class="na">SUB_REQUEST</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><code class="docutils literal"><span class="pre">UrlGeneratorProvider</span></code> を使っている場合、URIを生成することが出来ます。</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;url_generator&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>他にも心に留めておく必要があることはいくつかあります。ほとんどの場合、現在のマスタリクエストに対し、複数のサブリクエストを発行したいでしょう。例えば、クッキー、サーバ情報、セッションなどです。それらについては <a class="reference internal" href="cookbook/sub_requests.html"><em>サブリクエストの作り方</em></a> を読んでください。</p>
</div>
<div class="section" id="json">
<h2>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h2>
<p>JSONデータを返したければ、 <code class="docutils literal"><span class="pre">json</span></code> ヘルパーメソッドを使うことが出来ます。
ヘルパーメソッドに対し、単にデータ、ステータスコード、ヘッダを渡せばレスポンスのためのJSONが生成されます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">getUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The user was not found.&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$error</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="streaming">
<h2>ストリーミング (Streaming)<a class="headerlink" href="#streaming" title="Permalink to this headline">¶</a></h2>
<p>ストリーミングのレスポンスを作成することができます。 これは送信されるデータをバッファリングできないときに重要です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/images/{file}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/images/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;The image was not found.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/png&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>大きいかたまり(チャンク)で送信したい場合は、 <code class="docutils literal"><span class="pre">ob_fluch</span></code> と <code class="docutils literal"><span class="pre">flush</span></code> を全てのチャンクの後で呼んでください。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;http://www.example.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fh</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fh</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
      <span class="nb">ob_flush</span><span class="p">();</span>
      <span class="nb">flush</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-a-file">
<h2>ファイル送信 (Sending a file)<a class="headerlink" href="#sending-a-file" title="Permalink to this headline">¶</a></h2>
<p>もしファイルを返したければ、 <code class="docutils literal"><span class="pre">sendFile</span></code> というヘルパーメソッドが使えます。これによって、公に利用可能でないかもしれないファイルを返すことが容易になります。単にファイルパスとステータスコードとヘッダとコンテンツの位置をヘルパーメソッドに渡すと、 <code class="docutils literal"><span class="pre">BinaryFileResponse</span></code> に基づいたレスポンスが生成されます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/files/{path}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>値を返す前に、レスポンスを更にカスタマイズするには、　<a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html">SymfonyComponentHttpFoundationBinaryFileResponse</a> のAPIドキュメントを調べてみてください。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">return</span> <span class="nv">$app</span>
    <span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setContentDisposition</span><span class="p">(</span><span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_ATTACHMENT</span><span class="p">,</span> <span class="s1">&#39;pic.jpg&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">この機能を使用するためにはHttpFoundation 2.2以上が必要です。</p>
</div>
</div>
<div class="section" id="traits">
<h2>トレイト (Traits)<a class="headerlink" href="#traits" title="Permalink to this headline">¶</a></h2>
<p>Silexではショートカットメソッドを定義するトレイトを使用可能です。</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">この機能を使用するためには、PHP 5.4以上が必要です。</p>
</div>
<p>ほとんど全ての標準で組み込まれているサービスプロバイダーは、いくつかの対応するトレイトを持っています。それらを使うためには、使いたいトレイトを含んだ独自のアプリケーションクラスを定義してください。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Silex\Application</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyApplication</span> <span class="k">extends</span> <span class="nx">Application</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Application\TwigTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SecurityTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\FormTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\UrlGeneratorTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SwiftmailerTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\MonologTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\TranslationTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>ルーティングクラスを定義し、対応するトレイトを使用することも可能です。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Silex\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyRoute</span> <span class="k">extends</span> <span class="nx">Route</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Route\SecurityTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>新しく定義したルーティングクラスを使うためには <code class="docutils literal"><span class="pre">$app['route_class']</span></code>
をオーバーライドしてください。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;route_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MyRoute&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>追加されるメソッドについて学ぶには、それぞれのプロバイダについての章を読んでください。</p>
</div>
<div class="section" id="security">
<h2>セキュリティ (Security)<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>アプリケーションを攻撃から防御する方法を確認しておきましょう。</p>
<div class="section" id="escaping">
<h3>エスケープ処理 (Escaping)<a class="headerlink" href="#escaping" title="Permalink to this headline">¶</a></h3>
<p>ルーティング変数や、リクエストから受け取るされる GET/POST の変数など、ユーザーが入力した値を出力するときはいつでも、正しくエスケープ処理を行う必要があります。
そうすることでクロスサイトスクリプティング(XSS)を防ぐことができます。</p>
<ul>
<li><p class="first"><strong>HTML のエスケープ処理</strong>: HTML のエスケープ処理のために PHP は <code class="docutils literal"><span class="pre">htmlspecialchars</span></code> 関数 を用意してくれています。
Silex ではこの関数へのショートカットとして <code class="docutils literal"><span class="pre">escape</span></code> メソッドを次のように使うことができます。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;You provided the name </span><span class="si">{</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>もし Twig テンプレートを使うのであれば、 Twig が用意してくれているエスケープのための記述を使ったり、自動エスケープ機能を使うべきです。</p>
</li>
<li><p class="first"><strong>JSON のエスケープ処理</strong>: もし JSON フォーマットのデータをアプリケーションをで提供するなら、 Silexの <code class="docutils literal"><span class="pre">json</span></code> 関数を使うべきです。</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name.json&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Silex\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<p>commit: fc8bbb623f33ce448c8bf1d4a95aa26360032de1
original: <a class="reference external" href="https://github.com/silexphp/Silex/blob/master/doc/usage.rst">https://github.com/silexphp/Silex/blob/master/doc/usage.rst</a></p>
</div>
</div>
</div>


<div id="page_prev_next">
<a class="prev" href="intro.html">< イントロダクション (Introduction)</a>
<a class="next" href="middlewares.html">ミドルウェア (Middlewares) ></a>
</div>

<div class="common_content_footer">
<ul>
  <li> → <a href="http://silex-project.org/doc/usage.html">公式英語ドキュメント</a></li>
  <li> → <a href="https://github.com/fabpot/Silex/commits/master/doc/usage.rst">原文コミット履歴</a>
  <li> → <a href="https://github.com/brtriver/silex-doc-ja/commits/master/source/usage.rst">翻訳コミット履歴</a>
</ul>
<br />
翻訳の不備などは、お気軽にコメント欄にてご指摘ください！
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>このページのコンテンツ</h3>
  <ul>
<li><a class="reference internal" href="#">使用方法 (Usage)</a><ul>
<li><a class="reference internal" href="#installation">インストール (Installation)</a></li>
<li><a class="reference internal" href="#upgrading">アップグレード (Upgrading)</a></li>
<li><a class="reference internal" href="#bootstrap">ブートストラップ (Bootstrap)</a></li>
<li><a class="reference internal" href="#routing">ルーティング (Routing)</a><ul>
<li><a class="reference internal" href="#get-example-get-route">GET ルーティングの例 (Example GET route)</a></li>
<li><a class="reference internal" href="#dynamic-routing">動的ルーティング (Dynamic routing)</a></li>
<li><a class="reference internal" href="#post-example-post-route">POST ルーティングの例 (Example POST route)</a></li>
<li><a class="reference internal" href="#other-methods">他のメソッド (Other methods)</a></li>
<li><a class="reference internal" href="#route-variables">ルーティング変数 (Route variables)</a></li>
<li><a class="reference internal" href="#route-variables-converters">ルーティングで取得される変数の変換　(Route variables converters)</a></li>
<li><a class="reference internal" href="#requirements">必須項目 (Requirements)</a></li>
<li><a class="reference internal" href="#default-values">デフォルト値 (Default values)</a></li>
<li><a class="reference internal" href="#named-routes">名前付きルーティング (Named routes)</a></li>
<li><a class="reference internal" href="#controllers-in-classes">クラス内コントローラ (Controllers in classes)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-configuration">全体の設定 (Global Configuration)</a></li>
<li><a class="reference internal" href="#error-handlers">エラーハンドリング (Error handlers)</a></li>
<li><a class="reference internal" href="#redirects">リダイレクト (Redirects)</a></li>
<li><a class="reference internal" href="#forwards">フォワード (Forwards)</a></li>
<li><a class="reference internal" href="#json">JSON</a></li>
<li><a class="reference internal" href="#streaming">ストリーミング (Streaming)</a></li>
<li><a class="reference internal" href="#sending-a-file">ファイル送信 (Sending a file)</a></li>
<li><a class="reference internal" href="#traits">トレイト (Traits)</a></li>
<li><a class="reference internal" href="#security">セキュリティ (Security)</a><ul>
<li><a class="reference internal" href="#escaping">エスケープ処理 (Escaping)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のドキュメント</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">イントロダクション (Introduction)</a></p>
  <h4>次のドキュメント</h4>
  <p class="topless"><a href="middlewares.html"
                        title="next chapter">ミドルウェア (Middlewares)</a></p>
  <h3>ソース</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/usage.txt"
           rel="nofollow">ページのソースを表示</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

      </div>
      <!-- end #main -->
    </div>
    <!-- end #content_wrapper -->
  </div>
  <!-- end #content -->


  <div id="footer">
    <div id="footer_wrapper">
      <div id="footer_content">
        <div style=" position: relative;">
          <div id="footer_left"></div>
          <div id="footer_right"></div>
        </div>
        <div id="f_navbar">
        <ul>
            <li><a href="/">Silex ユーザーガイド</a></li>
            <li><a href="index.html">日本語ドキュメント TOP (索引)</a></li>
            <li><a href="providers/index.html">プロバイダー 一覧</a></li>
            <li><a href="http://silex.sensiolabs.org/">Silex 公式サイト(英語)</a></li>
            <li><a href="http://www.symfony.gr.jp/">日本Symfonyユーザー会</a></li>
        </ul>
      </div>
      <!-- end #navbar -->
      </div>
      <!-- end #footer_content -->
        </div>
        <!-- end #footer_wrapper -->
      </div>
      <!-- end #footer -->
    </div>
  </body>
</html>